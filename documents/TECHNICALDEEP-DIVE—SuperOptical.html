<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TECHNICAL DEEP-DIVE — Super Optical</title>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Montserrat:wght@400;700;900&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #e31e24;
            --secondary: #0f172a;
            --code-bg: #1e293b;
            --text-muted: #64748b;
            --bg: #f8fafc;
            --card: #ffffff;
            --border: #e2e8f0;
        }

        * { margin:0; padding:0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: #1e293b; line-height: 1.6; }

        .container { max-width: 1200px; margin: 0 auto; padding: 4rem 2rem; }

        header { text-align: center; margin-bottom: 5rem; }
        header h1 { font-family: 'Montserrat', sans-serif; font-size: 3rem; font-weight: 900; letter-spacing: -2px; color: var(--secondary); }
        .version-tag { background: var(--primary); color: white; padding: 0.3rem 1rem; border-radius: 99px; font-size: 0.8rem; font-weight: 700; margin-top: 1rem; display: inline-block; }

        .section-nav { display: flex; justify-content: center; gap: 1rem; margin-bottom: 4rem; overflow-x: auto; padding: 1rem; }
        .nav-btn { padding: 0.8rem 1.5rem; border: none; background: white; border: 1px solid var(--border); border-radius: 12px; cursor: pointer; font-weight: 600; transition: 0.3s; color: var(--text-muted); }
        .nav-btn.active { background: var(--primary); color: white; border-color: var(--primary); box-shadow: 0 10px 15px -3px rgba(227, 30, 36, 0.3); }

        .content-panel { display: none; background: var(--card); border-radius: 24px; padding: 3rem; border: 1px solid var(--border); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
        .content-panel.active { display: block; animation: fadeIn 0.4s ease; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        h2 { font-family: 'Montserrat', sans-serif; margin-bottom: 2rem; display: flex; align-items: center; gap: 1rem; font-size: 1.8rem; }
        h3 { margin: 2rem 0 1rem; border-left: 4px solid var(--primary); padding-left: 1rem; font-size: 1.2rem; }

        table { width: 100%; border-collapse: collapse; margin-bottom: 2rem; }
        th { background: #f1f5f9; text-align: left; padding: 1rem; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px; }
        td { padding: 1rem; border-bottom: 1px solid #f1f5f9; font-size: 0.95rem; }

        .code-block { background: var(--code-bg); color: #e2e8f0; padding: 1.5rem; border-radius: 12px; font-family: 'Fira Code', monospace; font-size: 0.85rem; overflow-x: auto; margin-bottom: 2rem; }
        .status-pill { padding: 0.2rem 0.6rem; border-radius: 6px; font-size: 0.75rem; font-weight: 700; }
        .bg-blue { background: #dbeafe; color: #1e40af; }
        .bg-green { background: #dcfce7; color: #166534; }

        .feature-card { border: 1px solid var(--border); border-radius: 16px; padding: 1.5rem; margin-bottom: 1rem; transition: 0.3s; }
        .feature-card:hover { border-color: var(--primary); transform: translateX(5px); }
    </style>
</head>
<body>

<div class="container">
    <header>
        <span class="version-tag">LEVEL 2 — ULTRA MICRO DOC</span>
        <h1>Technical Deep-Dive</h1>
        <p>Micro-level analysis of Database, APIs, and Core Algorithms.</p>
    </header>

    <nav class="section-nav">
        <button class="nav-btn active" onclick="switchPanel('db')"><i class="fa-solid fa-database"></i> Database Index</button>
        <button class="nav-btn" onclick="switchPanel('api')"><i class="fa-solid fa-code"></i> API Engine</button>
        <button class="nav-btn" onclick="switchPanel('logic')"><i class="fa-solid fa-brain"></i> Core Logic</button>
        <button class="nav-btn" onclick="switchPanel('security')"><i class="fa-solid fa-shield-halved"></i> Security</button>
    </nav>

    <!-- Database Panel -->
    <div id="db" class="content-panel active">
        <h2><i class="fa-solid fa-table"></i> Data Dictionary</h2>
        <p>The system utilizes a relational MySQL schema with specialized tables for eCommerce, clinical data, and dynamic settings.</p>
        
        <h3>1. eCommerce Cluster</h3>
        <table>
            <tr><th>Table</th><th>Keys</th><th>Description</th></tr>
            <tr><td><code>products</code></td><td><code>sku, price, stock</code></td><td>Main SKU repository. Supports HTML descriptions.</td></tr>
            <tr><td><code>product_variants</code></td><td><code>variant_id, color</code></td><td>Attribute-level pricing and inventory.</td></tr>
            <tr><td><code>categories</code></td><td><code>parent_id, slug</code></td><td>Hierarchical tree for store navigation.</td></tr>
            <tr><td><code>orders</code></td><td><code>order_number</code></td><td>Transactional master records with payment status.</td></tr>
        </table>

        <h3>2. System & Logs Cluster</h3>
        <div class="feature-card">
            <strong><code>settings</code> Table</strong>: Acts as the data source for the theme engine. Stores key-value pairs for colors, fonts, and global flags.
        </div>
        <div class="feature-card">
            <strong><code>payment_logs</code> Table</strong>: Captures raw JSON responses from Razorpay. Essential for forensic analysis of failed transactions.
        </div>
        <div class="feature-card">
            <strong><code>audit_logs</code> Table</strong>: Tracks <code>old_values</code> and <code>new_values</code> for every admin action.
        </div>
    </div>

    <!-- API Panel -->
    <div id="api" class="content-panel">
        <h2><i class="fa-solid fa-plug"></i> API Endpoint Specifications</h2>
        
        <div class="feature-card">
            <span class="status-pill bg-blue">ENDPOINT</span> <code>/api/appointment_slots.php</code>
            <p style="margin-top:0.5rem">Generates 30-minute availability windows based on <code>appointment_max_slots</code> setting.</p>
            <div class="code-block">
                GET ?date=2026-02-15<br>
                Verification: Check if (booked_count < max_slots) -> Return array of strings.
            </div>
        </div>

        <div class="feature-card">
            <span class="status-pill bg-blue">ENDPOINT</span> <code>/api/apply_coupon.php</code>
            <p style="margin-top:0.5rem">Executes a 5-point validation stack: Expiry, StartDate, MinOrder, UsageLimit, and UserAuth.</p>
        </div>

        <div class="feature-card">
            <span class="status-pill bg-blue">ENDPOINT</span> <code>/api/verify_payment.php</code>
            <p style="margin-top:0.5rem">Processes Razorpay POST-payment webhooks/callbacks. Handles atomic stock reduction and transactional order creation.</p>
        </div>
    </div>

    <!-- Logic Panel -->
    <div id="logic" class="content-panel">
        <h2><i class="fa-solid fa-gears"></i> Core Logic & Algorithms</h2>
        
        <h3>Asset Pipeline (optimizeUpload)</h3>
        <div class="code-block">
            - Detect MimeType<br>
            - Generate [thumb|medium|large] variants<br>
            - Parallel WebP conversion<br>
            - Quality compression (85% JPEG / 80% WebP)
        </div>

        <h3>Stock Governance</h3>
        <ul style="list-style: none;">
            <li style="margin-bottom: 2rem;">
                <strong>Atomic Reduction</strong>: On successful payment verification, stock is reduced inside a PDO Transaction to prevent race conditions during heavy traffic.
            </li>
            <li>
                <strong>Trigger Notifications</strong>: If (new_stock <= low_stock_threshold), a system notification is pushed to the admin dashboard instantly.
            </li>
        </ul>
    </div>

    <!-- Security Panel -->
    <div id="security" class="content-panel">
        <h2><i class="fa-solid fa-lock"></i> Security Architecture</h2>
        
        <div class="grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
            <div class="feature-card">
                <h4>Data Protection</h4>
                <p>The <code>IntegrationManager</code> uses AES-256 encryption to store third-party API keys in the database. Decryption only occurs at runtime through a restricted singleton instance.</p>
            </div>
            <div class="feature-card">
                <h4>Input Security</h4>
                <p>All user inputs pass through a central <code>sanitize()</code> filter. HTML descriptions are governed by <code>sanitizeAllowedHtml()</code> using a strict whitelist of safe tags.</p>
            </div>
        </div>
    </div>
</div>

<script>
    function switchPanel(panelId) {
        document.querySelectorAll('.content-panel').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        
        document.getElementById(panelId).classList.add('active');
        event.currentTarget.classList.add('active');
    }
</script>

</body>
</html>

